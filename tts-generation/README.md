# Generate simulated TTS data using several TTS models

## Data preprocessing

After we get simulated conversational data using OpenAI's API inference, we need to extract the text for User in the conversations.

These segments are then used to generate audio data using TTS models.

```bash
python get_conversation_round.py --input_json ./outout_all.json --output_json ./conversation_round_no_interruption_label.json
```

## F5TTS

### Configuration and Model Preparation

To use F5-TTS, please follow the instructions in the [F5TTS repository](https://github.com/SWivid/F5-TTS) to install the required dependencies.

Please refer to the [README.md](./F5TTS/ckpts/README.md) to download the pre-trained models and place them in the `F5TTS/ckpts` directory.

### Data Preparation

We use Librispeech dev-clean as the reference speech for F5TTS.
Please download the dataset and put them into `F5TTS/data/LibriSpeech/dev-clean`. The prepared kaldi format is in `F5TTS/data/LibriSpeech/dev_clean`.

For noise inserted into the speech, we use the [MUSAN](https://www.openslr.org/17/) dataset. Please download the dataset and put them into `F5TTS/data/MUSAN`.

### Single Turn Speech Generation
To generate single turn speech, run the following command:

```bash
python F5TTS/generate_using_f5tts.py
```

### Multi-turn Speech Combination
To combine the generated single turn speech into multi-turn speech, run the following command:

```bash
python F5TTS/combine_single_tomulti.py
```
In this code, we use the [SileroVAD](https://github.com/snakers4/silero-vad) to remove the silence generated by the TTS model. This is to precisely control the duration of each turn in the conversation.

This code will generate a clean version of three different difficulty levels of conversations in `F5TTS/data/f5tts-single-round-combine-easy`, `F5TTS/data/f5tts-single-round-combine-med`, and `F5TTS/data/f5tts-single-round-combine-hard`.


### Multi-turn Speech Combination with Noise
To combine the generated single turn speech into multi-turn speech with background noise, run the following command after adjusting the `snr` parameter in the code:

```bash
python F5TTS/combine_single_tomulti_all_noise_background.py
```

We will get three different background noisy levels of conversations, `F5TTS/data/f5tts-single-round-combine-easy-noisy-bg-20dB`, `F5TTS/data/f5tts-single-round-combine-easy-noisy-bg-10dB`, and `F5TTS/data/f5tts-single-round-combine-easy-noisy-bg-0dB`.

To combine the generated single turn speech into multi-turn speech with noise inserted into the gap, run the following command after adjusting the `snr` parameter in the code:

```bash
python F5TTS/combine_single_tomulti_all_noise_gap.py
```
We will get three different noise inserted levels of conversations, `F5TTS/data/f5tts-single-round-combine-easy-noisy-gap-20dB`, `F5TTS/data/f5tts-single-round-combine-easy-noisy-gap-10dB`, and `F5TTS/data/f5tts-single-round-combine-easy-noisy-gap-0dB`.

## ChatTTS 
**NOTE: In ChatTTS, we are using the built-in Speaker libraries instead of random samples from Librispeech dev-clean dataset.**

### Configuration and Model Preparation
To use ChatTTS, please follow the instructions in the [README.md](./ChatTTS/README.md) to install the required dependencies.
Please refer to [Huggingface ChatTTS](https://huggingface.co/2Noise/ChatTTS) to download the pre-trained models and place them in the `ChatTTS/asset` directory.

### Data Preparation
Please see above for the MUSAN data preparation steps under F5TTS. If you already put the MUSAN data in `F5TTS/data/MUSAN`, you can skip this step.

### Single Turn Speech Generation
To generate single turn speech, run the following command:

```bash
python ChatTTS/generate_using_chattts.py
```

### Multi-turn Speech Combination
To combine the generated single turn speech into multi-turn speech, run the following command:

```bash
python ChatTTS/combine_single_tomulti.py
```
This code will generate a clean version of three different difficulty levels of conversations in `ChatTTS/data/chattts-single-round-combine-easy`, `ChatTTS/data/chattts-single-round-combine-med`, and `ChatTTS/data/chattts-single-round-combine-hard`.

### Multi-turn Speech Combination with Noise
To combine the generated single turn speech into multi-turn speech with background noise, run the following command after adjusting the `snr` parameter in the code:

```bash
python ChatTTS/combine_single_tomulti_all_noise_background.py
```
We will get three different background noisy levels of conversations, `ChatTTS/data/chattts-single-round-combine-easy-noisy-bg-20dB`, `ChatTTS/data/chattts-single-round-combine-easy-noisy-bg-10dB`, and `ChatTTS/data/chattts-single-round-combine-easy-noisy-bg-0dB`.

To combine the generated single turn speech into multi-turn speech with noise inserted into the gap, run the following command after adjusting the `snr` parameter in the code:

```bash
python ChatTTS/combine_single_tomulti_all_noise_gap.py
```
We will get three different noise inserted levels of conversations, `ChatTTS/data/chattts-single-round-combine-easy-noisy-gap-20dB`, `ChatTTS/data/chattts-single-round-combine-easy-noisy-gap-10dB`, and `ChatTTS/data/chattts-single-round-combine-easy-noisy-gap-0dB`.

## Cosyvoice 2

### Configuration and Model Preparation

Please follow the instructions in the [Cosyvoice 2](./CosyVoice2/README.md) to install the required dependencies and download the `CosyVoice2-0.5B` model into `CosyVoice2/pretrained_models` folder.

### Data Preparation
Please see above for the MUSAN and Librispeech data preparation steps under F5TTS. If you already put the MUSAN data in `F5TTS/data/MUSAN`, and Librispeech data in `F5TTS/data/LibriSpeech`, you can skip this step.

### Single Turn Speech Generation
To generate single turn speech, run the following command:

```bash
python CosyVoice2/generate_using_cosyvoice2.py
```

### Multi-turn Speech Combination
To combine the generated single turn speech into multi-turn speech, run the following command:

```bash
python CosyVoice2/combine_single_tomulti.py
```
This code will generate a clean version of three different difficulty levels of conversations in `CosyVoice2/data/cosyvoice2-single-round-combine-easy`, `CosyVoice2/data/cosyvoice2-single-round-combine-med`, and `CosyVoice2/data/cosyvoice2-single-round-combine-hard`.

### Multi-turn Speech Combination with Noise
To combine the generated single turn speech into multi-turn speech with background noise, run the following command after adjusting the `snr` parameter in the code:

```bash
python CosyVoice2/combine_single_tomulti_all_noise_background.py
```
We will get three different background noisy levels of conversations, `CosyVoice2/data/cosyvoice2-single-round-combine-easy-noisy-bg-20dB`, `CosyVoice2/data/cosyvoice2-single-round-combine-easy-noisy-bg-10dB`, and `CosyVoice2/data/cosyvoice2-single-round-combine-easy-noisy-bg-0dB`.

To combine the generated single turn speech into multi-turn speech with noise inserted into the gap, run the following command after adjusting the `snr` parameter in the code:

```bash
python CosyVoice2/combine_single_tomulti_all_noise_gap.py
```
We will get three different noise inserted levels of conversations, `CosyVoice2/data/cosyvoice2-single-round-combine-easy-noisy-gap-20dB`, `CosyVoice2/data/cosyvoice2-single-round-combine-easy-noisy-gap-10dB`, and `CosyVoice2/data/cosyvoice2-single-round-combine-easy-noisy-gap-0dB`.